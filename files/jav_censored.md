### FP AV - JavCensored 모듈

#### 1. 개요

JavCensored 모듈은 지정된 폴더의 영상 파일을 분석하여 품번을 추출하고, 사용자가 설정한 규칙에 따라 라이브러리 폴더로 이동 및 정리하는 자동화 도구입니다. 메타데이터 플러그인과 연동하여 작품 정보를 활용할 수 있습니다.

**필수 요구사항**

이 모듈은 **metadata 플러그인**이 설치 및 활성화되어 있어야 모든 기능이 정상적으로 작동합니다.

---

#### 2. 설정 항목 안내

##### 2.1. 기본 탭

| 설정 항목                 | 설명                                                                                                                                 |
| :------------------------ | :----------------------------------------------------------------------------------------------------------------------------------- |
| **다운로드 폴더**         | `(필수)` 처리할 영상 파일이 있는 폴더 경로를 입력합니다. 여러 개일 경우 줄바꿈으로 구분합니다.                                     |
| **처리 실패시 이동 폴더** | `(필수)` 품번 추출 실패 등 처리 중 오류가 발생한 파일을 이동시킬 폴더입니다.                                                       |
| **중복인 경우 이동 폴더** | 라이브러리에 동일한 파일(이름, 크기 기준)이 이미 있을 경우, 처리하던 파일을 이동시킬 폴더입니다. 비워두면 파일을 삭제합니다.         |
| **품번 파싱 제외 키워드** | 품번 파싱시 품번에 사용되지 않도록 제외할 문자열 목록입니다. 웹사이트 주소, 릴 그룹명 등이나 품번으로 오인될 수 있는 문자열을 등록합니다. 너무 짧거나 레이블에 포함될만한 문자열은 등록을 피해야 합니다. (파이프 `|`로 구분) |
| **파일명 예외 키워드**    | 파일명에 포함될 경우 처리를 중단하고 `[FILENAME NOT ALLOWED]` 폴더로 이동시킬 키워드 목록입니다. (파이프 `\|`로 구분)                |
| **파일당 처리 딜레이**    | 개별 파일 처리 전 대기 시간(초)입니다. 메타데이터 사이트에 대한 연속적인 요청을 방지합니다. (기본값: 0)                              |

---

##### 2.2. 파일명 탭

| 설정 항목                          | 설명                                                                                                                                                     |
| :--------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **파일명 변경**                    | `On`으로 설정 시, 추출된 품번을 기반으로 파일명을 변경합니다. (예: `ssis-123.mp4`)                                                                       |
| **분할 파일 처리**                 | `On`으로 설정 시, `-1`, `_c` 등 분할 정보를 Plex 표준인 `cd1`, `cd3` 등으로 변환합니다. `Off`로 설정하면 이 변환을 건너뛰고 분할 정보 부분을 제거합니다. `-c`의 경우는 `-a`, `-b` 등이 있을 때만 분할 파일(cd3)로 처리합니다. |
| **파일명 변경시 원본 파일명 처리** | 파일명을 변경할 때, 원본 파일명의 정보를 괄호 `[]` 안에 보존할지 결정합니다.                                                                             |
| **원본 파일명 형식**               | 위 옵션이 `On`일 때, 괄호 안에 포함될 정보의 형식을 선택합니다. (원본명, 파일 크기 등)                                                                   |

---

##### 2.3. 폴더구조 탭

###### 메타 검색 사용: `사용안함`

- 오직 파일명에서 추출한 정보만으로 파일을 정리합니다.
- **라이브러리 폴더**: 정리된 파일이 최종적으로 위치할 폴더입니다.
- **기본 폴더 구조**: 폴더 경로 생성에 사용할 형식입니다. 사용 가능한 변수는 다음과 같습니다.
  - `{code}`: 품번 전체 (예: `ssis-123`)
  - `{label}`: 품번의 레이블 부분 (예: `ssis`)
  - `{label_1}`: 레이블의 첫 글자 (예: `s`)
  - **예시**: `{label_1}/{label}/{code}`

###### 메타 검색 사용: `사용`

- metadata 플러그인을 통해 작품 정보를 가져와 정리 규칙에 활용합니다.
- **정상 매칭시 이동 경로**: 메타 정보 조회에 성공한 파일들이 이동될 루트 폴더입니다.
- **폴더 구조**: `사용안함`의 변수 외에 아래 변수들을 추가로 사용할 수 있습니다.

| 변수        | 설명                               | 예시                     |
| :---------- | :--------------------------------- | :----------------------- |
| `{year}`    | 출시 연도                          | `2023`                   |
| `{studio}`  | 제작사                             | `S1 NO.1 STYLE`          |
| `{actor}`   | 첫 번째 배우 이름                  | `Yua Mikami`             |
| `{actor_2}` | 첫 두 명의 배우 이름 (쉼표로 구분) | `Yua Mikami,Ena Satsuki` |
| `{actor_3}` | 첫 세 명의 배우 이름               | `...`                    |

- **메타 없는 영상 이동**: 메타 검색 실패 시 파일 처리 방식을 결정합니다.
  - **이동 (On)**: 파일을 지정된 '이동 경로'로 옮겨 불필요한 재검색을 방지합니다. **(권장)**
  - **이동 안함 (Off)**: 파일을 원본 위치에 그대로 둡니다.
  - **이동 시 파일명 변경**: `On`으로 설정하면, 메타 없는 파일도 품번 기반으로 파일명을 변경하여 이동합니다.

---

#### 3. 고급 설정: 레이블 특수처리 규칙

이 모듈은 `metadata` 플러그인의 설정에 정의된 **`레이블 특수처리 규칙**을 가져와 파일명에서 품번 파싱에 활용합니다. 이를 통해 내장된 일반 규칙으로는 처리할 수 없는 변칙적인 파일명에 대응할 수 있습니다.

---

###### 규칙 설정 위치

설정 > metadata > 설정 > 레이블 특수처리 규칙

---

###### 규칙 형식

```
(정규표현식) => (레이블 템플릿)|(숫자 템플릿)
```

- **정규표현식**: 파일명(전처리 후)에서 원하는 부분을 찾기 위한 패턴입니다. 캡처 그룹 `()`을 사용하여 필요한 부분을 추출합니다.
- **=>**: 구분 기호입니다.
- **레이블 템플릿**: 추출된 캡처 그룹을 조합하여 최종 "레이블" 부분을 만듭니다. `{0}`, `{1}`... 와 같이 0부터 시작하는 인덱스로 그룹을 참조합니다.
- **|**: 구분 기호입니다.
- **숫자 템플릿**: 추출된 캡처 그룹을 조합하여 최종 "숫자" 부분을 만듭니다.

---

##### 예제

###### 예제 1: `T28/T38` 처리

- **문제 파일명**: `(TMA) T-28610.mp4`, `hhd800.com@t38-039.mp4`
- **목표 품번**: `t28-610`, `t38-039`
- **Type 0 규칙**:
  ```
  .*?(?<![a-z])(t)[-_]?(28|38)[-_]?(\d+)(?=[^\d]|\b) => {0}{1}|{2}
  ```
- **분석**:
  - `{0}`은 첫 번째 그룹 `(t)`에 해당합니다.
  - `{1}`은 두 번째 그룹 `(28|38)`에 해당합니다.
  - `{2}`는 세 번째 그룹 `(\d+)`에 해당합니다.
  - 레이블은 `{0}{1}` (`t28`), 숫자는 `{2}` (`610`)로 조합됩니다.

###### 예제 2: `CPZ` 시리즈 처리

- **문제 파일명**: `CPZ69-H005.mp4`
- **목표 품번**: `cpz69-h005`
- **Type 0 규칙**:
  ```
  .*?(?<![a-z])(cpz\d{2})[-_]?([a-z]\d+)(?=[^\d]|\b) => {0}|{1}
  ```
- **분석**:
  - `{0}`은 첫 번째 그룹 `(cpz\d{2})` (`cpz69`)에 해당합니다.
  - `{1}`은 두 번째 그룹 `([a-z]\d+)` (`h005`)에 해당합니다.
  - 레이블은 `{0}` (`cpz69`), 숫자는 `{1}` (`h005`)로 조합됩니다.
